var musicContainer=document.getElementById("music-container"),playBtn=document.getElementById("play"),prevBtn=document.getElementById("prev"),nextBtn=document.getElementById("next"),audio=document.getElementById("audio"),progress=document.getElementById("progress"),progressContainer=document.getElementById("progress-container"),title=document.getElementById("title"),currTime=document.querySelector("#currTime"),durTime=document.querySelector("#durTime"),songListItems=document.querySelectorAll(".song-list-item"),
content=[],bandArt="",songIndex=0;function getAlbumImg(){for(var a=0,d=0;d<content.length;d++)for(var b=0;b<content[d].songs.length;b++){if(a==songIndex)return"img/"+preText(content[d].songs[b])+content[d].title+".png";a++}}function coverSrc(a){a="img/"+a+".png";if(fileExists(a))return a;if(fileExists(getAlbumImg()))return getAlbumImg();if(fileExists(bandArt))return bandArt}
function loadSong(a){var d=document.getElementById("cover");title.innerText=sanitiseText(a);audio.src="music/"+a+".mp3";d.src=coverSrc(a)}function playSong(){musicContainer.classList.add("play");playBtn.querySelector("i.fas").classList.remove("fa-play");playBtn.querySelector("i.fas").classList.add("fa-pause");audio.play()}
function pauseSong(){musicContainer.classList.remove("play");playBtn.querySelector("i.fas").classList.add("fa-play");playBtn.querySelector("i.fas").classList.remove("fa-pause");audio.pause()}function loadAndPlaySong(a){loadSong(a);playSong()}function prevSong(){songIndex--;0>songIndex&&(songIndex=songs.length-1);loadAndPlaySong(songs[songIndex])}function nextSong(){songIndex++;songIndex>songs.length-1&&(songIndex=0);loadAndPlaySong(songs[songIndex])}
function updateProgress(a){a=a.srcElement;progress.style.width=a.currentTime/a.duration*100+"%"}function setProgress(a){audio.currentTime=a.offsetX/this.clientWidth*audio.duration}function loadAndPlayFromListItem(a){a=a.target;null!==a&&null!==a.dataset.index&&void 0!==a.dataset.index&&(songIndex=a.dataset.index,loadAndPlaySong(songs[songIndex]))}
function DurTime(a){a=a.srcElement;var d=a.duration;a=a.currentTime;var b,c,f=null==a?0:Math.floor(a/60),f=10>f?"0"+f:f;(function(a){if(60<=Math.floor(a))for(var c=1;60>=c;c++)Math.floor(a)>=60*c&&Math.floor(a)<60*(c+1)&&(b=Math.floor(a)-60*c,b=10>b?"0"+b:b);else b=Math.floor(a),b=10>b?"0"+b:b})(a,b);null!==currTime&&(currTime.innerHTML=f+":"+b);a=!0===isNaN(d)?"0":Math.floor(d/60);a=10>a?"0"+a:a;(function(a){if(60<=Math.floor(a))for(var b=1;60>=b;b++)Math.floor(a)>=60*b&&Math.floor(a)<60*(b+1)&&
(c=Math.floor(a)-60*b,c=10>c?"0"+c:c);else c=!0===isNaN(d)?"0":Math.floor(a),c=10>c?"0"+c:c})(d);null!==durTime&&(durTime.innerHTML=a+":"+c)}
function openBand(a){var d,b,c=a.srcElement;if(c){pauseSong();b=document.getElementsByClassName("tabcontent");for(d=0;d<b.length;d++)b[d].style.display="none";b=document.getElementsByClassName("tablinks");for(d=0;d<b.length;d++)b[d].className=b[d].className.replace(" active","");songIndex=0;b=c.innerText;var f="img/"+c.dataset.img,g=JSON.parse(c.dataset.blurb);d=c.dataset.disableDownload;content=JSON.parse(c.dataset.content);log(c);log(f);log(b);log(content);log(g);songs=[];bandArt=f;for(c=0;c<content.length;c++)for(var e=
0;e<content[c].songs.length;e++)songs.push(content[c].songs[e]);log(songs);c=document.getElementById("blurb-container");c.innerHTML="";e=document.createElement("img");e.classList.add("band-img");e.src=f;e.alt=b;c.appendChild(e);for(f=0;f<g.length;f++){var e=document.createElement("p"),h=document.createTextNode(g[f]);e.appendChild(h);c.appendChild(e)}document.getElementById("band-name").innerText=b;b=document.getElementById("song-img-container");b.innerHTML="";g=document.createElement("img");g.id=
"cover";g.src=coverSrc(content[0].songs[0]);g.alt=sanitiseText(content[0].songs[0]);b.appendChild(g);b=document.getElementById("track-listing-container");b.classList.remove("scroll-it");10<songs.length&&b.classList.add("scroll-it");b=document.getElementById("track-listing");b.innerHTML="";for(f=g=0;f<content.length;f++)for(c=document.createElement("tr"),e=document.createElement("td"),e.colspan=2,e.style["padding-top"]="10px",e.style["padding-bottom"]="5px",e.innerHTML="<b>"+content[f].title+"</b>",
c.appendChild(e),b.appendChild(c),c=0;c<content[f].songs.length;c++){var e=document.createElement("tr"),h=document.createElement("td"),l=document.createElement("td");e.classList.add("hover-it");h.dataset.index=g;g++;h.classList.add("song-list-item");h.innerHTML=c+1+". "+sanitiseText(content[f].songs[c]);h.addEventListener("click",loadAndPlayFromListItem);if(!d){var k=document.createElement("a");k.href="music/"+content[f].songs[c]+".mp3";k.innerHTML="Download";k.download=sanitiseText(content[f].songs[c])+
".mp3";l.appendChild(k)}e.appendChild(h);e.appendChild(l);b.appendChild(e)}document.getElementById("band-container").style.display="block";a.currentTarget.className+=" active";addCacheBreaker();loadSong(songs[songIndex])}}playBtn.addEventListener("click",function(){musicContainer.classList.contains("play")?pauseSong():playSong()});prevBtn.addEventListener("click",prevSong);nextBtn.addEventListener("click",nextSong);audio.addEventListener("timeupdate",updateProgress);
progressContainer.addEventListener("click",setProgress);audio.addEventListener("ended",nextSong);audio.addEventListener("timeupdate",DurTime);document.getElementById("defaultOpen").click();
