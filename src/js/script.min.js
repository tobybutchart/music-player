var musicContainer=document.getElementById("music-container"),playBtn=document.getElementById("play"),prevBtn=document.getElementById("prev"),nextBtn=document.getElementById("next"),audio=document.getElementById("audio"),progress=document.getElementById("progress"),progressContainer=document.getElementById("progress-container"),title=document.getElementById("title"),currTime=document.querySelector("#currTime"),durTime=document.querySelector("#durTime"),songListItems=document.querySelectorAll(".song-list-item"),
content=[],bandArt="",songIndex=0;function getAlbumImg(){for(var a=0,d=0;d<content.length;d++)for(var c=0;c<content[d].songs.length;c++){if(a==songIndex)return"img/"+preText(content[d].songs[c])+content[d].title+".png";a++}}function coverSrc(a){a="img/"+a+".png";if(fileExists(a))return a;if(fileExists(getAlbumImg()))return getAlbumImg();if(fileExists(bandArt))return bandArt}
function loadSong(a){var d=document.getElementById("cover");title.innerText=sanitiseText(a);audio.src="music/"+a+".mp3";d.src=coverSrc(a)}function playSong(){musicContainer.classList.add("play");playBtn.querySelector("i.fas").classList.remove("fa-play");playBtn.querySelector("i.fas").classList.add("fa-pause");audio.play()}
function pauseSong(){musicContainer.classList.remove("play");playBtn.querySelector("i.fas").classList.add("fa-play");playBtn.querySelector("i.fas").classList.remove("fa-pause");audio.pause()}function loadAndPlaySong(a){loadSong(a);playSong()}function prevSong(){songIndex--;0>songIndex&&(songIndex=songs.length-1);loadAndPlaySong(songs[songIndex])}function nextSong(){songIndex++;songIndex>songs.length-1&&(songIndex=0);loadAndPlaySong(songs[songIndex])}
function updateProgress(a){a=a.srcElement;progress.style.width=a.currentTime/a.duration*100+"%"}function setProgress(a){audio.currentTime=a.offsetX/this.clientWidth*audio.duration}function loadAndPlayFromListItem(a){a=a.target;null!==a&&null!==a.dataset.index&&void 0!==a.dataset.index&&(songIndex=a.dataset.index,loadAndPlaySong(songs[songIndex]))}
function DurTime(a){a=a.srcElement;var d=a.duration;a=a.currentTime;var c,b,f=null==a?0:Math.floor(a/60),f=10>f?"0"+f:f;(function(a){if(60<=Math.floor(a))for(var b=1;60>=b;b++)Math.floor(a)>=60*b&&Math.floor(a)<60*(b+1)&&(c=Math.floor(a)-60*b,c=10>c?"0"+c:c);else c=Math.floor(a),c=10>c?"0"+c:c})(a,c);null!==currTime&&(currTime.innerHTML=f+":"+c);a=!0===isNaN(d)?"0":Math.floor(d/60);a=10>a?"0"+a:a;(function(a){if(60<=Math.floor(a))for(var c=1;60>=c;c++)Math.floor(a)>=60*c&&Math.floor(a)<60*(c+1)&&
(b=Math.floor(a)-60*c,b=10>b?"0"+b:b);else b=!0===isNaN(d)?"0":Math.floor(a),b=10>b?"0"+b:b})(d);null!==durTime&&(durTime.innerHTML=a+":"+b)}
function openBand(a){var d,c,b=a.srcElement;if(b){pauseSong();c=document.getElementsByClassName("tabcontent");for(d=0;d<c.length;d++)c[d].style.display="none";c=document.getElementsByClassName("tablinks");for(d=0;d<c.length;d++)c[d].className=c[d].className.replace(" active","");songIndex=0;d=b.innerText;var f="img/"+b.dataset.img;c=JSON.parse(b.dataset.blurb);content=JSON.parse(b.dataset.content);log(b);log(f);log(d);log(content);log(c);songs=[];bandArt=f;for(b=0;b<content.length;b++)for(var e=0;e<
content[b].songs.length;e++)songs.push(content[b].songs[e]);log(songs);b=document.getElementById("blurb-container");b.innerHTML="";e=document.createElement("img");e.classList.add("band-img");e.src=f;e.alt=d;b.appendChild(e);for(f=0;f<c.length;f++){var e=document.createElement("p"),g=document.createTextNode(c[f]);e.appendChild(g);b.appendChild(e)}document.getElementById("band-name").innerText=d;d=document.getElementById("song-img-container");d.innerHTML="";c=document.createElement("img");c.id="cover";
c.src=coverSrc(content[0].songs[0]);c.alt=sanitiseText(content[0].songs[0]);d.appendChild(c);d=document.getElementById("track-listing-container");d.classList.remove("scroll-it");10<songs.length&&d.classList.add("scroll-it");d=document.getElementById("track-listing");d.innerHTML="";for(f=c=0;f<content.length;f++)for(b=document.createElement("tr"),e=document.createElement("td"),e.colspan=2,e.style["padding-top"]="10px",e.style["padding-bottom"]="5px",e.innerHTML="<b>"+content[f].title+"</b>",b.appendChild(e),
d.appendChild(b),b=0;b<content[f].songs.length;b++){var e=document.createElement("tr"),g=document.createElement("td"),k=document.createElement("td");e.classList.add("hover-it");g.dataset.index=c;c++;g.classList.add("song-list-item");g.innerHTML=b+1+". "+sanitiseText(content[f].songs[b]);g.addEventListener("click",loadAndPlayFromListItem);var h=document.createElement("a");h.href="music/"+content[f].songs[b]+".mp3";h.innerHTML="Download";h.download="music/"+content[f].songs[b]+".mp3";k.appendChild(h);
e.appendChild(g);e.appendChild(k);d.appendChild(e)}document.getElementById("band-container").style.display="block";a.currentTarget.className+=" active";addCacheBreaker();loadSong(songs[songIndex])}}playBtn.addEventListener("click",function(){musicContainer.classList.contains("play")?pauseSong():playSong()});prevBtn.addEventListener("click",prevSong);nextBtn.addEventListener("click",nextSong);audio.addEventListener("timeupdate",updateProgress);progressContainer.addEventListener("click",setProgress);
audio.addEventListener("ended",nextSong);audio.addEventListener("timeupdate",DurTime);document.getElementById("defaultOpen").click();
